(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0f97fe21"],{3671:function(e,t,r){"use strict";var i=r("1c1e");function s(e){return i["a"].post("/api/meeting",e)}function a(e){return i["a"].remove("/api/meeting",e)}function o(e,t){return i["a"].put("/api/meeting",e,t)}function n(e){return i["a"].get("/api/meeting",e)}function l(e){return i["a"].get("/api/meeting",null,e)}function m(e){return i["a"].download("/api/meeting/exportExcel",e)}function c(e){return i["a"].post("/api/meeting/review",e)}t["a"]={create:s,remove:a,update:o,get:n,query:l,exportExcel:m,review:c}},"5c9a":function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"meeting-detail"},[r("h1",{staticClass:"meeting-detail__title"},[e._v("会议详情")]),r("el-form",{ref:"meetingForm",attrs:{disabled:!e.saveVisible,model:e.form,rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"会议名称",prop:"name"}},[r("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),r("el-form-item",{attrs:{label:"内容",prop:"content"}},[r("el-input",{staticStyle:{width:"500px"},attrs:{rows:4,type:"textarea"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),r("el-form-item",{attrs:{label:"会议室",prop:"roomId"}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:e.form.roomId,callback:function(t){e.$set(e.form,"roomId",t)},expression:"form.roomId"}},e._l(e.roomList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),r("el-form-item",{attrs:{label:"人员名单",prop:"accountIds"}},[r("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:e.form.accountIds,callback:function(t){e.$set(e.form,"accountIds",t)},expression:"form.accountIds"}},e._l(e.accountList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),r("el-form-item",{attrs:{label:"会议室预定"}},[r("FullCalendar",{attrs:{options:e.calendarOptions}})],1)],1),r("el-form",[r("el-form-item",[e.$hasPermission("MEETING_UPDATE")?r("el-button",{staticStyle:{"margin-left":"100px"},attrs:{type:"primary"},on:{click:e.showSaveButton}},[e._v("编辑\n      ")]):e._e(),e.$hasPermission("MEETING_UPDATE")&&e.saveVisible?r("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("保存\n      ")]):e._e()],1)],1)],1)},s=[],a=r("3671"),o=r("8fe2"),n=r("ccf4"),l=r("968f"),m=(r("5574"),r("f5ff")),c=r("3cdd"),u=r("a20c"),d=r("7989"),f=r("2ef7"),p=(r("f9e3"),r("15f5"),r("2824")),h={name:"MeetingDetail",props:{defaultValues:{type:Object,default(){return{id:"",name:"",content:"",accountIds:"",roomName:"",accounts:"",roomId:"",reserveStartTime:"",reserveEndTime:""}}}},components:{FullCalendar:m["a"]},data(){return{rules:o["a"],form:Object.assign({},this.defaultValues),roomList:[],accountList:[],saveVisible:!1,hasSelected:!1,id:this.$route.query.id,calendarOptions:{plugins:[c["a"],u["a"],d["a"],f["a"]],initialView:"resourceTimeline",schedulerLicenseKey:"CC-Attribution-NonCommercial-NoDerivatives",selectable:!0,height:600,resources:[],events:[],select:this.handleSelect,eventDrop:this.eventDrop,eventResize:this.eventResize}}},mounted(){this.id&&(this.getDetail(this.id),this.isEdit=!0,this.saveVisible=!1)},created(){this.queryRoomList(),this.queryAccountList(),this.queryRoomResource(),this.queryReserveEvents()},watch:{$route(e,t){e.path.includes("/meeting-detail")&&"undefined"!==typeof e.query.id&&(this.id=e.query.id,this.form.imageList=[],this.getDetail(this.id),this.saveVisible=!1)}},methods:{async queryRoomResource(){const{data:e}=await l["a"].resource({pageSize:1e3,pageNum:1});this.calendarOptions.resources=e.rows},async queryReserveEvents(){const{data:e}=await p["a"].events({pageSize:1e3,pageNum:1});this.calendarOptions.events=e.rows},eventResize(e){e.startDelta.milliseconds+this.form.reserveStartTime<(new Date).getTime()?this.$message.error("预约时间不能小于当前时间"):(this.form.reserveStartTime=this.form.reserveStartTime+e.startDelta.milliseconds,this.form.reserveEndTime=this.form.reserveEndTime+e.endDelta.milliseconds)},eventDrop(e){if(this.form.reserveStartTime+e.delta.milliseconds<(new Date).getTime())return e.revert,void this.$message.error("预约时间不能小于当前时间");this.form.reserveStartTime=this.form.reserveStartTime+e.delta.milliseconds,this.form.reserveEndTime=this.form.reserveEndTime+e.delta.milliseconds},handleSelect(e){new Date(e.start).getTime()<(new Date).getTime()?this.$message.error("预约时间不能小于当前时间"):this.hasSelected?this.$message.error("一次只能预约一个时间段"):(this.hasSelected=!0,this.form.roomId=e.resource.id,this.form.reserveStartTime=new Date(e.start).getTime(),this.form.reserveEndTime=new Date(e.end).getTime(),this.calendarOptions.events.push({color:"#0099C",displayEventTime:!0,editable:!0,start:e.start,end:e.end,title:this.form.name,resourceIds:[e.resource.id]}))},async getDetail(e){const{data:t}=await a["a"].get(e);this.form=t},async queryRoomList(){const{data:e}=await l["a"].query({pageSize:1e3,pageNum:1});this.roomList=e.rows},async queryAccountList(){const{data:e}=await n["a"].query({pageSize:1e3,pageNum:1});this.accountList=e.rows},async submitForm(){try{await this.$refs.meetingForm.validate()}catch(e){return Promise.reject(new Error("表单校验失败"))}try{let e=Object.assign({},this.form);await a["a"].update(e.id,e),await this.queryReserveEvents(),this.saveVisible=!1,this.$emit("success"),this.$message.success("编辑成功！")}catch(t){this.$message.error("编辑失败！原因："+t.message)}},showSaveButton(){this.saveVisible=!0}}},g=h,v=(r("9a80"),r("2877")),b=Object(v["a"])(g,i,s,!1,null,null,null);t["default"]=b.exports},"7ea5":function(e,t,r){},"8fe2":function(e,t,r){"use strict";t["a"]={name:[{required:!0,message:"请输入会议名称",trigger:"blur"},{type:"string",max:15,trigger:"blur",message:"会议名称长度不能超过15"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}],roomId:[{required:!0,message:"请选择会议室",trigger:"blur"}],accountIds:[{required:!0,message:"请输入人员名单",trigger:"blur"}]}},"968f":function(e,t,r){"use strict";var i=r("1c1e");function s(e){return i["a"].post("/api/room",e)}function a(e){return i["a"].remove("/api/room",e)}function o(e,t){return i["a"].put("/api/room",e,t)}function n(e){return i["a"].get("/api/room",e)}function l(e){return i["a"].get("/api/room",null,e)}function m(e){return i["a"].get("/api/room/resource",null,e)}function c(e){return i["a"].download("/api/room/exportExcel",e)}t["a"]={create:s,remove:a,update:o,get:n,query:l,resource:m,exportExcel:c}},"9a80":function(e,t,r){"use strict";r("7ea5")}}]);