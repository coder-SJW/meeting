(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3bb2f392"],{"1ac1":function(e,t,i){"use strict";i("64bc")},"1ddd":function(e,t,i){"use strict";i("2e2f")},2271:function(e,t,i){},"2e2f":function(e,t,i){},"3f7a":function(e,t,i){"use strict";var l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",e._g(e._b({staticClass:"dialog",attrs:{"close-on-click-modal":!1,"modal-append-to-body":!1,visible:e.elDialogVisible},on:{close:e.onClose,"update:visible":e.toggleVisible}},"el-dialog",e.$attrs,!1),e.listeners),[e.$attrs.title?e._e():i("template",{slot:"title"},[e._t("title")],2),e._t("default"),e.noFooter?e._e():i("template",{slot:"footer"},[e.$slots.footer?e._t("footer",null,{closeDialog:function(){return e.toggleVisible(!1)}}):[e.cancelBtn?i("el-button",{on:{click:function(t){return e.toggleVisible(!1)}}},[e._v("\n        取消\n      ")]):e._e(),i("el-button",{attrs:{disabled:e.disabledBtn,loading:e.pending,type:"primary"},on:{click:e.confirm}},[e._v("\n        "+e._s(e.confirmText)+"\n      ")])]],2)],2)},a=[];let s,n;function r(){return void 0!==s||(s=void 0!==window.ontransitionend?"transitionend":void 0!==window.onwebkittransitionend?"webkittransitionend":""),s}function o(){return void 0!==n||(n=void 0!==window.onanimationend?"animationend":void 0!==window.onwebkitanimationend?"webkitanimationend":""),n}var d={name:"VDialog",inheritAttrs:!1,props:{visible:{type:Boolean,default:!0},onConfirm:Function,cancelBtn:{type:Boolean,default:!0},disabledBtn:{type:Boolean,dafault:!1},noFooter:{type:Boolean,default:!1},confirmText:{type:String,default:"确定"}},data(){return{elDialogVisible:!1,pending:!1}},computed:{listeners(){let e={};for(let t in this.$listeners)-1===["update:visible","close","confirm"].indexOf(t)&&(e[t]=this.$listeners[t]);return e}},watch:{visible:{handler(e){e!==this.elDialogVisible&&(this.elDialogVisible=e)},immediate:!0}},methods:{toggleVisible(e){this.elDialogVisible=e,this.$emit("update:visible",e)},onClose(){let e=r(),t=o();if(e&&t){let i=()=>{this.$emit("close"),this.$el.removeEventListener(e,i),this.$el.removeEventListener(t,i)};this.$el.addEventListener(e,i),this.$el.addEventListener(t,i)}else this.$nextFrame(()=>this.$emit("close"))},confirm(){const e=e=>{this.pending=!1,!(e instanceof Error)&&this.toggleVisible(!1)};this.pending=!0,this.onConfirm&&this.onConfirm().then(e,e)}}},c=d,u=(i("1ddd"),i("2877")),E=Object(u["a"])(c,l,a,!1,null,"08c14ed2",null);t["a"]=E.exports},"4d55":function(e,t,i){"use strict";i("2271")},"61d9":function(e,t,i){"use strict";var l=i("1c1e");function a(e){return l["a"].post("/api/role",e)}function s(e){return l["a"].remove("/api/role",e)}function n(e,t){return l["a"].put("/api/role",e,t)}function r(e){return l["a"].get("/api/role",e)}function o(e){return l["a"].get("/api/role",null,e)}t["a"]={create:a,remove:s,update:n,get:r,query:o}},"64bc":function(e,t,i){},efbe:function(e,t,i){"use strict";i.r(t);var l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"crumbs"},[i("el-breadcrumb",{attrs:{separator:"/"}},[i("el-breadcrumb-item",[i("i",{staticClass:"el-icon-lx-cascades"}),e._v(" 角色管理\n      ")])],1)],1),i("div",{staticClass:"container"},[i("div",{staticClass:"handle-box"},[i("el-form",{attrs:{inline:""}},[i("el-form-item",{attrs:{label:"角色名称"}},[i("el-input",{staticClass:"handle-input mr10",staticStyle:{width:"180px"},model:{value:e.filter.name,callback:function(t){e.$set(e.filter,"name",t)},expression:"filter.name"}})],1),i("el-form-item",[e.$hasPermission("ROLE_QUERY")?i("el-button",{attrs:{icon:"el-icon-search",type:"primary"},on:{click:function(t){return e.queryList()}}},[e._v("查询\n          ")]):e._e(),e.$hasPermission("ROLE_CREATE")?i("el-button",{attrs:{icon:"el-icon-search",type:"primary"},on:{click:function(t){return e.create()}}},[e._v("创建\n          ")]):e._e()],1)],1)],1),i("paged-table",{attrs:{"current-page":e.filter.pageNum,data:e.tableData,"page-size":e.filter.pageSize,total:e.total},on:{"current-change":e.queryList,"size-change":e.pageSizeChange}},[i("el-table-column",{attrs:{label:"名称",prop:"name"}}),i("el-table-column",{attrs:{label:"角色类型",prop:"type"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-tag",{attrs:{type:2===t.row.type?"success":"danger"}},[e._v(e._s(2===t.row.type?"系统默认角色":"自定义角色")+"\n          ")])]}}])}),i("el-table-column",{attrs:{label:"备注",prop:"description"}}),i("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[e._v(e._s(e._f("formatDate")(i.createTime)))]}}])}),i("el-table-column",{attrs:{label:"修改时间"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[e._v(e._s(e._f("formatDate")(i.updateTime)))]}}])}),i("el-table-column",{attrs:{align:"center",label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$hasPermission("ROLE_UPDATE")?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){return e.edit(t.row)}}},[e._v("编辑\n          ")]):e._e(),e.$hasPermission("ROLE_DELETE")?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){return e.remove(t.row.id)}}},[e._v("删除\n          ")]):e._e()]}}])})],1)],1)])},a=[],s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("af-dialog",{staticClass:"system-role-dialog",attrs:{"on-confirm":e.submitForm,title:e.isEdit?"编辑角色":"创建角色",visible:e.visible},on:{"update:visible":function(t){e.visible=t},close:function(t){return e.$emit("close")}}},[i("el-form",{ref:"roleForm",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"名称",prop:"name"}},[i("el-input",{attrs:{disabled:e.isEdit,placeholder:"名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),i("el-form-item",{attrs:{label:"备注"}},[i("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),i("el-form-item",{staticClass:"tree__item",attrs:{label:"菜单权限"}},[i("el-tree",{ref:"authTree",staticClass:"auth__tree",attrs:{data:e.menu,"expand-on-click-node":!1,props:e.defaultProps,"check-on-click-node":"","default-expand-all":"","node-key":"id","show-checkbox":""}})],1)],1)],1)},n=[],r=i("3f7a"),o=i("61d9"),d={name:[{required:!0,message:"请输入角色名",trigger:"blur"},{type:"string",max:32,trigger:"blur",message:"角色名长度不能超过32"}]};const c=["ACCOUNT","ROLE","SYS_LOG","MEETING","REPAIR","RESERVE","ROOM"],u=[{id:0,label:"全选",children:[{id:"DASHBOARD",label:"主页"},{id:"MEETING",label:"会议管理",children:[{id:"MY_MEETING",label:"会议管理-我的会议"},{id:"MEETING_QUERY",label:"会议管理-查询"},{id:"MEETING_CREATE",label:"会议管理-创建"},{id:"MEETING_UPDATE",label:"会议管理-编辑"},{id:"MEETING_DELETE",label:"会议管理-删除"},{id:"MEETING_EXPORT",label:"会议管理-导出"},{id:"MEETING_REVIEW",label:"会议管理-审核"}]},{id:"REPAIR",label:"报修管理",children:[{id:"REPAIR_QUERY",label:"报修管理-查询"},{id:"REPAIR_CREATE",label:"报修管理-创建"},{id:"REPAIR_UPDATE",label:"报修管理-编辑"},{id:"REPAIR_DELETE",label:"报修管理-删除"},{id:"REPAIR_EXPORT",label:"报修管理-导出"}]},{id:"RESERVE",label:"预约记录管理",children:[{id:"RESERVE_QUERY",label:"预约记录管理-查询"},{id:"RESERVE_CREATE",label:"预约记录管理-创建"},{id:"RESERVE_UPDATE",label:"预约记录管理-编辑"},{id:"RESERVE_DELETE",label:"预约记录管理-删除"},{id:"RESERVE_EXPORT",label:"预约记录管理-导出"}]},{id:"ROOM",label:"会议室管理",children:[{id:"ROOM_QUERY",label:"会议室管理-查询"},{id:"ROOM_CREATE",label:"会议室管理-创建"},{id:"ROOM_UPDATE",label:"会议室管理-编辑"},{id:"ROOM_DELETE",label:"会议室管理-删除"},{id:"ROOM_EXPORT",label:"会议室管理-导出"}]},{id:"ROLE",label:"角色管理",children:[{id:"ROLE_QUERY",label:"角色管理-查询"},{id:"ROLE_CREATE",label:"角色管理-创建"},{id:"ROLE_UPDATE",label:"角色管理-编辑"},{id:"ROLE_DELETE",label:"角色管理-删除"}]},{id:"ACCOUNT",label:"用户管理",children:[{id:"ACCOUNT_QUERY",label:"用户管理-查询"},{id:"ACCOUNT_CREATE",label:"用户管理-创建"},{id:"ACCOUNT_UPDATE",label:"用户管理-编辑"},{id:"ACCOUNT_DELETE",label:"用户管理-删除"},{id:"ACCOUNT_PERSONAL",label:"用户管理-个人信息修改"},{id:"ACCOUNT_CHANGE_PASSWORD",label:"用户管理-修改密码"}]},{id:"DEPARTMENT",label:"部门管理",children:[{id:"DEPARTMENT_QUERY",label:"部门管理-查询"},{id:"DEPARTMENT_CREATE",label:"部门管理-创建"},{id:"DEPARTMENT_UPDATE",label:"部门管理-编辑"},{id:"DEPARTMENT_DELETE",label:"部门管理-删除"},{id:"DEPARTMENT_EXPORT",label:"部门管理-导出"}]},{id:"SYS_LOG",label:"系统日志管理",children:[{id:"SYS_LOG_QUERY",label:"系统日志管理-查询"}]}]}];var E={name:"RoleDialog",components:{AfDialog:r["a"]},props:{defaultValues:{type:Object,default(){return{name:""}}},isEdit:{type:Boolean,dafault:()=>!1}},data(){return{rules:d,form:this.defaultValues,visible:!1,menu:u,defaultProps:{children:"children",label:"label"}}},computed:{},async created(){if(this.form.id){const e=await o["a"].get(this.form.id);this.$refs.authTree.setCheckedKeys(e.data.authorities.filter(e=>!c.includes(e))),this.description=e.data.description,this.form.name=e.data.name}},methods:{async submitForm(){try{await this.$refs.roleForm.validate()}catch(e){return Promise.reject(new Error("表单校验失败"))}try{let e=Object.assign({},this.form);e.authorities=this.$refs.authTree.getCheckedKeys().concat(this.$refs.authTree.getHalfCheckedKeys()).filter(e=>"number"!==typeof e),this.isEdit?await o["a"].update(e.id,e):await o["a"].create(e),this.$emit("success"),this.$message.success((this.isEdit?"编辑":"创建")+"成功！")}catch(t){this.$message.error((this.isEdit?"编辑":"创建")+"失败！原因："+t.message)}}}},b=E,m=(i("4d55"),i("2877")),f=Object(m["a"])(b,s,n,!1,null,null,null),p=f.exports,h=i("0748"),_={name:"Role",components:{PagedTable:h["a"]},data(){return{filter:{name:"",pageNum:1,pageSize:20},total:0,tableData:[],roleList:[]}},created(){this.$dialog.register("role-dialog",p),this.queryList()},methods:{async queryList(e=1){this.filter.pageNum=e;const t=Object.assign({},this.filter),{data:i}=await o["a"].query(t);this.total=i.count,this.tableData=i.rows},pageSizeChange(e){this.filter.pageSize=e,this.queryList()},edit(e){const t={isEdit:!0,roleList:this.roleList};t.defaultValues=Object.assign({},e),this.openDialog("role-dialog",t)},openDialog(e,t={},i={success:this.queryList}){this.$dialog.open(e,{props:t,on:i})},async remove(e){await this.$confirm("是否确认删除？","删除",{type:"warn"});try{await o["a"].remove(e),this.$message.success("删除成功！"),this.queryList()}catch(t){this.$message.error("删除失败！原因："+t.message)}},create(){const e={isEdit:!1,roleList:this.roleList};this.openDialog("role-dialog",e)}}},g=_,R=(i("1ac1"),Object(m["a"])(g,l,a,!1,null,"35cd734b",null));t["default"]=R.exports}}]);