(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-220993b9"],{"0442":function(e,t,r){"use strict";r("2c80")},"2c80":function(e,t,r){},3671:function(e,t,r){"use strict";var s=r("1c1e");function i(e){return s["a"].post("/api/meeting",e)}function a(e){return s["a"].remove("/api/meeting",e)}function n(e,t){return s["a"].put("/api/meeting",e,t)}function o(e){return s["a"].get("/api/meeting",e)}function c(e){return s["a"].get("/api/meeting",null,e)}function l(e){return s["a"].download("/api/meeting/exportExcel",e)}function m(e){return s["a"].post("/api/meeting/review",e)}t["a"]={create:i,remove:a,update:n,get:o,query:c,exportExcel:l,review:m}},"3f01":function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"meeting-create"},[r("h1",{staticClass:"meeting-create__title"},[e._v("创建会议")]),r("el-form",{ref:"meetingForm",attrs:{disabled:!e.saveVisible,model:e.form,rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"会议名称",prop:"name"}},[r("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),r("el-form-item",{attrs:{label:"内容",prop:"content"}},[r("el-input",{staticStyle:{width:"500px"},attrs:{rows:4,type:"textarea"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),r("el-form-item",{attrs:{label:"人员名单",prop:"accountIds"}},[r("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:e.form.accountIds,callback:function(t){e.$set(e.form,"accountIds",t)},expression:"form.accountIds"}},e._l(e.accountList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),r("el-form-item",{attrs:{label:"会议室预定"}},[r("FullCalendar",{attrs:{options:e.calendarOptions}})],1)],1),r("el-form",[r("el-form-item",[e.$hasPermission("MEETING_CREATE")&&e.saveVisible?r("el-button",{staticStyle:{"margin-left":"100px"},attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("保存\n      ")]):e._e()],1)],1)],1)},i=[],a=r("3671"),n=r("ccf4"),o=r("8fe2"),c=r("968f"),l=(r("5574"),r("f5ff")),m=r("3cdd"),u=r("a20c"),d=r("7989"),f=r("2ef7"),p=(r("f9e3"),r("15f5"),r("2824")),h=r("4387"),v=r.n(h),g={name:"MeetingDetail",components:{FullCalendar:l["a"]},props:{defaultValues:{type:Object,default(){return{id:"",name:"",content:"",accountIds:"",roomName:"",roomId:"",reserveStartTime:"",reserveEndTime:"",status:0}}}},data(){return{form:Object.assign({},this.defaultValues),rules:o["a"],roomList:[],accountList:[],saveVisible:!0,hasSelected:!1,calendarOptions:{locale:v.a,plugins:[m["a"],u["a"],d["a"],f["a"]],initialView:"resourceTimeline",schedulerLicenseKey:"CC-Attribution-NonCommercial-NoDerivatives",selectable:!0,height:600,resources:[],events:[],select:this.handleSelect,eventDrop:this.eventDrop,eventResize:this.eventResize}}},created(){this.queryRoomResource(),this.queryReserveEvents(),this.queryAccountList()},watch:{$route(e,t){e.path.includes("/$tool.firstLowerCase($foreignModel)-create")&&(this.form=this.defaultValues,this.defaultValues.imageList=[],this.saveVisible=!0)}},methods:{eventResize(e){e.startDelta.milliseconds+this.form.reserveStartTime<(new Date).getTime()?this.$message.error("预约时间不能小于当前时间"):(this.form.reserveStartTime=this.form.reserveStartTime+e.startDelta.milliseconds,this.form.reserveEndTime=this.form.reserveEndTime+e.endDelta.milliseconds)},eventDrop(e){if(this.form.reserveStartTime+e.delta.milliseconds<(new Date).getTime())return e.revert,void this.$message.error("预约时间不能小于当前时间");this.form.reserveStartTime=this.form.reserveStartTime+e.delta.milliseconds,this.form.reserveEndTime=this.form.reserveEndTime+e.delta.milliseconds},handleSelect(e){new Date(e.start).getTime()<(new Date).getTime()?this.$message.error("预约时间不能小于当前时间"):this.hasSelected?this.$message.error("一次只能预约一个时间段"):(this.hasSelected=!0,this.form.roomId=e.resource.id,this.form.reserveStartTime=new Date(e.start).getTime(),this.form.reserveEndTime=new Date(e.end).getTime(),this.calendarOptions.events.push({color:"#0099C",displayEventTime:!0,editable:!0,start:e.start,end:e.end,title:this.form.name,resourceIds:[e.resource.id]}))},async queryAccountList(){const{data:e}=await n["a"].query({pageSize:1e3,pageNum:1});this.accountList=e.rows},async queryRoomResource(){const{data:e}=await c["a"].resource({pageSize:1e3,pageNum:1});this.calendarOptions.resources=e.rows},async queryReserveEvents(){const{data:e}=await p["a"].events({pageSize:1e3,pageNum:1});this.calendarOptions.events=e.rows},async submitForm(){try{await this.$refs.meetingForm.validate()}catch(e){return Promise.reject(new Error("表单校验失败"))}try{if(!this.form.roomId)return void this.$message.error("请选择会议室");let e=Object.assign({},this.form);this.saveVisible=!1,await a["a"].create(e),await this.queryReserveEvents(),this.$emit("success"),this.$message.success("创建成功！")}catch(t){this.$message.error("创建失败！原因："+t.message)}}}},w=g,b=(r("0442"),r("2877")),y=Object(b["a"])(w,s,i,!1,null,null,null);t["default"]=y.exports},4387:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={code:"zh-cn",week:{dow:1,doy:4},buttonText:{prev:"上月",next:"下月",today:"今天",month:"月",week:"周",day:"日",list:"日程"},weekText:"周",allDayText:"全天",moreLinkText:function(e){return"另外 "+e+" 个"},noEventsText:"没有事件显示"};t.default=s},"8fe2":function(e,t,r){"use strict";t["a"]={name:[{required:!0,message:"请输入会议名称",trigger:"blur"},{type:"string",max:15,trigger:"blur",message:"会议名称长度不能超过15"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}],roomId:[{required:!0,message:"请选择会议室",trigger:"blur"}],accountIds:[{required:!0,message:"请输入人员名单",trigger:"blur"}]}},"968f":function(e,t,r){"use strict";var s=r("1c1e");function i(e){return s["a"].post("/api/room",e)}function a(e){return s["a"].remove("/api/room",e)}function n(e,t){return s["a"].put("/api/room",e,t)}function o(e){return s["a"].get("/api/room",e)}function c(e){return s["a"].get("/api/room",null,e)}function l(e){return s["a"].get("/api/room/resource",null,e)}function m(e){return s["a"].download("/api/room/exportExcel",e)}t["a"]={create:i,remove:a,update:n,get:o,query:c,resource:l,exportExcel:m}}}]);